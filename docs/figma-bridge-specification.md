# FigmaBridge 詳細仕様書

## 概要

FigmaBridgeは、FigmaのデザインデータをZIPファイル形式でエクスポート・インポートできるFigmaプラグインです。デザインの共有やバックアップ、異なるFigmaファイル間でのデータ移行を支援します。

## 機能一覧

### 1. エクスポート機能

#### 1.1 エクスポートタイプ
- **選択されたノード**: 現在選択されているノードのみをエクスポート
- **現在のページ**: 現在のページに含まれるすべてのノードをエクスポート

#### 1.2 対応ノードタイプ
- **フレーム (Frame)**: レイアウトコンテナとして機能
- **グループ (Group)**: 複数のノードをまとめたコンテナ
- **テキスト (Text)**: テキストコンテンツ
- **図形**: 矩形、楕円、多角形、星、ベクター、線
- **画像**: 画像フィルを持つノード
- **シンボル/コンポーネント**: インスタンスとコンポーネント（基本情報のみ）

#### 1.3 保存される情報
- **基本プロパティ**: 名前、位置、サイズ、可視性、ロック状態
- **スタイル情報**: 塗りつぶし、ストローク、エフェクト、角丸
- **テキスト情報**: フォント、サイズ、配置、行間、文字間隔
- **レイアウト情報**: 制約、配置、自動レイアウト設定
- **階層構造**: 親子関係、グループ構造
- **画像データ**: PNG形式での画像ファイル

### 2. インポート機能

#### 2.1 インポートプロセス
1. ZIPファイルの読み込み
2. メタデータの解析
3. 画像ファイルの処理
4. ノードの再作成
5. 階層構造の復元

#### 2.2 復元される情報
- **基本プロパティ**: 名前、位置、サイズ、可視性、ロック状態
- **スタイル情報**: 塗りつぶし、ストローク、エフェクト、角丸
- **テキスト情報**: フォント、サイズ、配置、行間、文字間隔
- **レイアウト情報**: 制約、配置、自動レイアウト設定
- **階層構造**: 親子関係、グループ構造
- **画像データ**: 画像フィルの復元

## 制限事項

### 1. マスク処理の制限

#### 1.1 現在の制限
- **マスク構造の完全復元**: マスク処理（isMask）の復元は部分的にのみ対応
- **マスク順序**: マスク用ノードの順序が正しく復元されない場合がある
- **複雑なマスク**: ネストしたマスクや複雑なマスク構造は完全に復元されない

#### 1.2 技術的理由
- Figma APIの制限により、マスク構造の完全な再現が困難
- グループ化時のノード順序の制御に制限がある
- マスク用ノードの`isMask`プロパティの設定タイミングの問題

#### 1.3 回避策
- マスク処理が必要な場合は、インポート後に手動でマスク設定を行う
- 複雑なマスク構造は、元のFigmaファイルで再作成することを推奨

### 2. その他の制限

#### 2.1 グラデーション
- **グラデーション情報**: グラデーションの詳細情報（gradientStops、gradientTransform）は保存されない
- **理由**: Figma APIの制限により、グラデーション情報の完全な復元が困難

#### 2.2 アニメーション
- **アニメーション**: アニメーション情報は保存・復元されない
- **理由**: アニメーション機能はFigmaプラグインAPIでは対応していない

#### 2.3 プロトタイプ
- **プロトタイプ情報**: プロトタイプのリンクやインタラクション情報は保存されない
- **理由**: プロトタイプ機能はFigmaプラグインAPIでは対応していない

#### 2.4 プラグイン
- **プラグインデータ**: 他のプラグインで作成されたデータは保存されない
- **理由**: プラグイン固有のデータはFigma APIではアクセスできない

## ファイル形式

### 1. ZIPファイル構造
```
FigmaData_YYYY-MM-DDTHH-MM-SS.zip
├── metadata.json          # メタデータ（ノード情報）
├── image_files.json       # 画像ファイル情報
└── img/                   # 画像ファイルフォルダ
    ├── node1.png
    ├── node2.png
    └── ...
```

### 2. メタデータ形式
```json
{
  "metadata": {
    "type": "selected|page",
    "count": 10,
    "exportDate": "2025-01-20T10:30:00.000Z"
  },
  "nodes": [
    {
      "name": "node_name",
      "metadata": {
        "id": "node_id",
        "name": "node_name",
        "type": "FRAME|GROUP|TEXT|RECTANGLE|...",
        "x": 0,
        "y": 0,
        "width": 100,
        "height": 100,
        "visible": true,
        "locked": false,
        "fills": [...],
        "strokes": [...],
        "effects": [...],
        "groupStructure": {...},
        "frameStructure": {...}
      },
      "bytes": null
    }
  ]
}
```

## 技術仕様

### 1. 使用技術
- **Figma Plugin API**: Figmaとの連携
- **TypeScript**: 型安全性の確保
- **JSZip**: ZIPファイルの生成・解析
- **HTML/CSS/JavaScript**: UI実装

### 2. アーキテクチャ
- **メイン処理**: `figma/code.ts`
- **UI**: `figma/ui.html`
- **設定**: `figma/manifest.json`

### 3. エラーハンドリング
- **エクスポートエラー**: ノードの処理失敗時のスキップ
- **インポートエラー**: ノード作成失敗時のエラーメッセージ表示
- **ファイル形式エラー**: 無効なZIPファイルの検出

## 使用方法

### 1. エクスポート
1. Figmaでプラグインを起動
2. エクスポートタイプを選択
3. 「エクスポート」ボタンをクリック
4. ZIPファイルが自動ダウンロード

### 2. インポート
1. Figmaでプラグインを起動
2. 「ファイルを選択」でZIPファイルを選択
3. 「インポート」ボタンをクリック
4. ノードが現在のページに追加

## トラブルシューティング

### 1. よくある問題

#### 1.1 エクスポートが失敗する
- **原因**: 選択されたノードがない
- **解決策**: エクスポートしたいノードを選択してから実行

#### 1.2 インポートが失敗する
- **原因**: 無効なZIPファイル
- **解決策**: 正しいFigmaBridgeでエクスポートされたファイルを使用

#### 1.3 画像が表示されない
- **原因**: 画像ファイルの破損
- **解決策**: エクスポートを再実行

### 2. パフォーマンス
- **大きなファイル**: 大量のノードを含むファイルは処理に時間がかかる
- **画像サイズ**: 高解像度の画像はファイルサイズが大きくなる

## 今後の改善予定

### 1. 機能改善
- **マスク処理の完全対応**: マスク構造の完全復元
- **グラデーション対応**: グラデーション情報の保存・復元
- **バッチ処理**: 大量データの効率的な処理

### 2. ユーザビリティ改善
- **プログレス表示**: 処理進捗の詳細表示
- **プレビュー機能**: インポート前のプレビュー
- **設定オプション**: エクスポート・インポート設定のカスタマイズ

## ライセンス・著作権

- **開発者**: [開発者名]
- **ライセンス**: [ライセンス情報]
- **バージョン**: 1.0.0

---

*この仕様書は随時更新されます。最新版はGitHubリポジトリで確認してください。* 